{#================================================================#}

{% extends "base.html" %}

{% block title %}{{ course.title }}{% endblock %}

{% block content %}
    {#   !!!! –¢–æ–∑–∏ –∫–æ–¥ –≤ div –æ—Ç–¥–æ–ª—É –∑–∞–∫–æ–º–µ–Ω—Ç–∏—Ä–∞–Ω–∏—è—Ç , –æ–±—Ä—ä—â–∞ –º—è—Å—Ç–æ—Ç–æ –Ω–∞ –¢–ï–ö–°–ê (—Ç–µ–∫—Å—Ç–∞ —É—Ç–∏–≤–∞ –≤ –¥—è—Å–Ω–æ) –∏ –ë–£–¢–û–ù–ò–¢–ï(–í –ª—è–≤–æ)  !!!#}
    {#    <div class="course-container">#}
    {##}
    {#        <!-- –ó–∞–≥–ª–∞–≤–∏–µ -->#}
    {#        <div class="course-title-container">#}
    {#            <h2 class="course-title">{{ course.title }}</h2>#}
    {#        </div>#}
    {##}
    {#        <!-- –û—Å–Ω–æ–≤–µ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –¥–≤–µ –∫–æ–ª–æ–Ω–∏ -->#}
    {#        <div class="course-content">#}
    {##}
    {#            <!-- –î—è—Å–Ω–∞ –∫–æ–ª–æ–Ω–∞: –°–Ω–∏–º–∫–∞ + –¶–µ–Ω–∞, –±—É—Ç–æ–Ω–∏, —Ç–µ—Å—Ç–æ–≤–µ -->#}
    {#            <div class="course-right">#}
    {#                {% if course.image %}#}
    {#                    <div class="course-image-container">#}
    {#                        <img src="{{ course.image.url }}" alt="{{ course.title }}" class="course-image">#}
    {#                    </div>#}
    {#                {% endif %}#}
    {##}
    {#                <p class="course-price">üí∞ –¶–µ–Ω–∞: <span class="highlighted-price">{{ course.price }} –ª–≤.</span></p>#}
    {##}
    {#                {% if course.video_url %}#}
    {#                    <a href="{{ course.video_url }}" class="course-button video-button">#}
    {#                        üé• –ì–ª–µ–¥–∞–π –≤–∏–¥–µ–æ—Ç–æ#}
    {#                    </a>#}
    {#                {% endif %}#}
    {##}
    {#                {% if course.document %}#}
    {#                    <a href="{{ course.document.url }}" class="course-button document-button">#}
    {#                        üìÑ –ò–∑—Ç–µ–≥–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞#}
    {#                    </a>#}
    {#                {% endif %}#}
    {##}
    {#                {% if course.quizzes.all %}#}
    {#                    <button class="course-button quiz-toggle" onclick="toggleQuizDropdown(event)">üìù –¢–µ—Å—Ç–æ–≤–µ</button>#}
    {#                    <ul id="quiz-dropdown" class="quiz-dropdown">#}
    {#                        {% for quiz in course.quizzes.all %}#}
    {#                            <li>#}
    {#                                <a href="{% url 'quiz_detail' quiz.id %}" class="quiz-link">#}
    {#                                    {{ quiz.title }}#}
    {#                                </a>#}
    {#                            </li>#}
    {#                        {% endfor %}#}
    {#                    </ul>#}
    {#                {% endif %}#}
    {##}
    {#                <p class="course-price">üí∞ –¶–µ–Ω–∞: <span class="highlighted-price">{{ course.price }} –ª–≤.</span></p>#}
    {##}
    {#                <!-- –ë—É—Ç–æ–Ω –∑–∞ –ø–ª–∞—â–∞–Ω–µ -->#}
    {#                <form id="payment-form" class="payment-form">#}
    {#                    <button id="checkout-button" class="payment-button">#}
    {#                        üí≥ –ü–ª–∞—Ç–∏ —Å –∫–∞—Ä—Ç–∞#}
    {#                    </button>#}
    {#                </form>#}
    {#            </div>#}
    {##}
    {#            <!-- –õ—è–≤–∞ –∫–æ–ª–æ–Ω–∞: –û–ø–∏—Å–∞–Ω–∏–µ -->#}
    {#            <div class="course-left">#}
    {#                <p class="course-description">{{ course.description }}</p>#}
    {#            </div>#}
    {#        </div>#}
    {#    </div>#}
    {#---------------------------------------------#}


    <div class="course-container">

        <!-- –ó–∞–≥–ª–∞–≤–∏–µ -->
        <div class="course-title-container">
            <h2 class="course-title">{{ course.title }}</h2>
        </div>

        <div class="bg-yellow-100 text-yellow-800 px-4 py-2 rounded-lg text-lg font-semibold inline-block">
            ‚≠ê –°—Ä–µ–¥–µ–Ω —Ä–µ–π—Ç–∏–Ω–≥: {{ course.average_rating }} / 5
        </div>


        <!-- –û—Å–Ω–æ–≤–µ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –¥–≤–µ –∫–æ–ª–æ–Ω–∏ -->
        <div class="course-content">

            <!-- –õ—è–≤–∞ –∫–æ–ª–æ–Ω–∞: –û–ø–∏—Å–∞–Ω–∏–µ -->
            <div class="course-left">
                <p class="course-description">{{ course.description }}</p>
            </div>

            <!-- –î—è—Å–Ω–∞ –∫–æ–ª–æ–Ω–∞: –°–Ω–∏–º–∫–∞ + –¶–µ–Ω–∞, –±—É—Ç–æ–Ω–∏, —Ç–µ—Å—Ç–æ–≤–µ -->
            <div class="course-right">
                {% if course.image %}
                    <div class="course-image-container">
                        <img src="{{ course.image.url }}" alt="{{ course.title }}" class="course-image">
                    </div>
                {% endif %}

                {% if course.video_url %}
                    <a href="{{ course.video_url }}" class="course-button video-button">
                        üé• –ì–ª–µ–¥–∞–π –≤–∏–¥–µ–æ—Ç–æ
                    </a>
                {% endif %}

                {% if course.lessons.all %}
                    <a href="{% url 'course_lessons' course.id %}" class="course-button lessons-button">
                        üìö –£—Ä–æ—Ü–∏
                    </a>
                {% endif %}

                {% if course.quizzes.all %}
                    <button class="course-button quiz-toggle" onclick="toggleQuizDropdown(event)">üìù –¢–µ—Å—Ç–æ–≤–µ</button>
                    <ul id="quiz-dropdown" class="quiz-dropdown">
                        {% for quiz in course.quizzes.all %}
                            <li>
                                <a href="{% url 'quiz_detail' quiz.id %}" class="quiz-link">
                                    {{ quiz.title }}
                                </a>
                            </li>
                        {% endfor %}
                    </ul>
                {% endif %}


                {% if course.document %}
                    <a href="{{ course.document.url }}" class="course-button document-button">
                        üìÑ –ò–∑—Ç–µ–≥–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞
                    </a>
                {% endif %}



                <p class="course-price">üí∞ –¶–µ–Ω–∞: <span class="highlighted-price">{{ course.price }} –ª–≤.</span></p>

                {#                <div class="course-price-container">#}
                {#                    <p class="course-price">üí∞ –¶–µ–Ω–∞: <span class="highlighted-price">{{ course.price }} –ª–≤.</span></p>#}
                {#                </div>#}


                <!-- –ë—É—Ç–æ–Ω –∑–∞ –ø–ª–∞—â–∞–Ω–µ -->
                <form id="payment-form" class="payment-form">
                    <button id="checkout-button" class="payment-button">
                        üí≥ –ü–ª–∞—Ç–∏ —Å –∫–∞—Ä—Ç–∞
                    </button>
                </form>
            </div>
        </div>

        {#        <!--–î–æ–±–∞–≤—è–Ω–µ –Ω–∞ —Å–µ–∫—Ü–∏—è—Ç–∞ –∑–∞ —Ä–µ–≤—é—Ç–∞ –ü–û–î —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ—Ç–æ -->#}
        {#        <div class="course-reviews">#}
        {#            <h3 class="reviews-title">‚≠ê –†–µ–≤—é—Ç–∞</h3>#}
        {##}
        {#            {% for review in course.reviews.all|dictsortreversed:"created_at" %}#}
        {#                {% if review.is_approved %}#}
        {#                    <div class="border-b py-2">#}
        {#                        <p class="font-semibold">{{ review.user.email }} - <span#}
        {#                                class="text-yellow-500">‚òÖ {{ review.rating }}</span></p>#}
        {#                        <p class="text-gray-700">{{ review.comment }}</p>#}
        {#                        <p class="text-sm text-gray-500">{{ review.created_at|date:"d M Y" }}</p>#}
        {#                    </div>#}
        {#                {% endif %}#}
        {#            {% empty %}#}
        {#                <p class="text-gray-500">–í—Å–µ –æ—â–µ –Ω—è–º–∞ —Ä–µ–≤—é—Ç–∞ –∑–∞ —Ç–æ–∑–∏ –∫—É—Ä—Å.</p>#}
        {#            {% endfor %}#}
        {##}
        {##}
        {#            {% if request.user.is_authenticated %}#}
        {#                <a href="{% url 'add_review' course.id %}" class="add-review-button">#}
        {#                    ‚ûï –î–æ–±–∞–≤–∏ —Ä–µ–≤—é#}
        {#                </a>#}
        {#            {% else %}#}
        {#                <p class="login-message">–¢—Ä—è–±–≤–∞ –¥–∞ —Å—Ç–µ –≤–ª–µ–∑–ª–∏, –∑–∞ –¥–∞ –æ—Å—Ç–∞–≤–∏—Ç–µ —Ä–µ–≤—é.</p>#}
        {#            {% endif %}#}
        {#        </div>#}

        <!--  –î–æ–±–∞–≤—è–Ω–µ –Ω–∞ —Å–µ–∫—Ü–∏—è—Ç–∞ –∑–∞ —Ä–µ–≤—é—Ç–∞ –ü–û–î —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ—Ç–æ  -->
        <div class="course-reviews review-section bg-gray-100 p-4 rounded-lg mt-6">
            <h3 class="text-xl font-bold mb-4">‚≠ê –†–µ–≤—é—Ç–∞</h3>

            {% for review in course.reviews.all|dictsortreversed:"created_at" %}
                {% if review.is_approved %}
                    <div class="review-container">
                        <p class="review-user">{{ review.user.email }} - <span
                                class="review-rating">‚òÖ {{ review.rating }}</span></p>
                        <p class="review-comment">{{ review.comment }}</p>
                        <p class="review-date">{{ review.created_at|date:"d M Y" }}</p>
                    </div>
                {% endif %}
            {% empty %}
                <p class="text-gray-500 text-lg">‚ùå –í—Å–µ –æ—â–µ –Ω—è–º–∞ —Ä–µ–≤—é—Ç–∞ –∑–∞ —Ç–æ–∑–∏ –∫—É—Ä—Å.</p>
            {% endfor %}

            {% if request.user.is_authenticated %}
                <a href="{% url 'add_review' course.id %}" class="add-review-button">
                    ‚ûï –î–æ–±–∞–≤–∏ —Ä–µ–≤—é
                </a>
            {% else %}
                <p class="text-gray-500 mt-4">üîí –¢—Ä—è–±–≤–∞ –¥–∞ —Å—Ç–µ –≤–ª–µ–∑–ª–∏, –∑–∞ –¥–∞ –æ—Å—Ç–∞–≤–∏—Ç–µ —Ä–µ–≤—é.</p>
            {% endif %}
        </div>


    </div>


    <script src="https://js.stripe.com/v3/"></script>
    <script>
        function toggleQuizDropdown(event) {
            event.stopPropagation();
            var dropdown = document.getElementById("quiz-dropdown");
            dropdown.style.display = dropdown.style.display === "none" || dropdown.style.display === "" ? "block" : "none";
        }

        document.addEventListener("click", function (event) {
            var dropdown = document.getElementById("quiz-dropdown");
            if (dropdown.style.display === "block" && !event.target.closest(".quiz-toggle")) {
                dropdown.style.display = "none";
            }
        });

        document.getElementById("checkout-button").addEventListener("click", function (e) {
            e.preventDefault();
            fetch("{% url 'create_checkout_session' course.id %}", {
                method: "POST",
                headers: {"X-CSRFToken": "{{ csrf_token }}"},
            })
                .then(response => response.json())
                .then(session => {
                    Stripe("{{ STRIPE_PUBLISHABLE_KEY }}").redirectToCheckout({sessionId: session.sessionId});
                })
                .catch(error => alert("–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –ø–ª–∞—â–∞–Ω–µ!"));
        });
    </script>
{% endblock %}
